#
# ServerRoot: The top of the directory tree under which the server's
# configuration, error, and log files are kept.
#
# Do not add a slash at the end of the directory path.  If you point
# ServerRoot at a non-local disk, be sure to point the LockFile directive
# at a local disk.  If you wish to share the same ServerRoot for multiple
# httpd daemons, you will need to change at least LockFile and PidFile.
#
ServerRoot "/ndnp/staging/apache2"

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, instead of the default. See also the <VirtualHost>
# directive.
#
# Change this to Listen on specific IP addresses as shown below to 
# prevent Apache from glomming onto all bound IP addresses.
#

Listen *:8080

LoadModule wsgi_module modules/mod_wsgi.so
LoadModule cache_module modules/mod_cache.so
LoadModule expires_module modules/mod_expires.so
LoadModule rewrite_module modules/mod_rewrite.so

<IfModule mod_cache.c>
  LoadModule disk_cache_module modules/mod_disk_cache.so
  <IfModule mod_disk_cache.c>
    CacheIgnoreCacheControl On
    CacheRoot /indexes/cache
    CacheEnable disk /
    CacheEnable disk http://
    CacheDisable /data
    CacheDirLevels 5
    CacheDefaultExpire 3600
    CacheMaxFileSize 2000000
  </IfModule> 
</IfModule>


#
# Dynamic Shared Object (DSO) Support
#
# To be able to use the functionality of a module which was built as a DSO you
# have to place corresponding `LoadModule' lines at this location so the
# directives contained in it are actually available _before_ they are used.
# Statically compiled modules (those listed by `httpd -l') do not need
# to be loaded here.
#
# Example:
# LoadModule foo_module modules/mod_foo.so
#

<IfModule !mpm_netware_module>
<IfModule !mpm_winnt_module>
#
# If you wish httpd to run as a different user or group, you must run
# httpd as root initially and it will switch.  
#
# User/Group: The name (or #number) of the user/group to run httpd as.
# It is usually good practice to create a dedicated user and group for
# running httpd, as with most system services.
#
#User daemon
#Group daemon

</IfModule>
</IfModule>

# 'Main' server configuration
#
# The directives in this section set up the values used by the 'main'
# server, which responds to any requests that aren't handled by a
# <VirtualHost> definition.  These values also provide defaults for
# any <VirtualHost> containers you may define later in the file.
#
# All of these directives may appear inside <VirtualHost> containers,
# in which case these default settings will be overridden for the
# virtual host being defined.
#

#
# ServerAdmin: Your address, where problems with the server should be
# e-mailed.  This address appears on some server-generated pages, such
# as error documents.  e.g. admin@your-domain.com
#
ServerAdmin you@example.com

#
# ServerName gives the name and port that the server uses to identify itself.
# This can often be determined automatically, but we recommend you specify
# it explicitly to prevent problems during startup.
#
# If your host doesn't have a registered DNS name, enter its IP address here.
#

ServerName chroniclingamerica.loc.gov

RewriteEngine  on

#RewriteCond %{HTTP_HOST}   !^chroniclingamerica\.loc\.gov [NC]
#RewriteCond %{HTTP_HOST}   !^$
#RewriteRule ^/(.*)         http://chroniclingamerica.loc.gov/$1 [redirect,last]

RewriteRule ^/index.html / [redirect=permanent,last]
RewriteRule ^/availableNewspapers.html /newspapers/ [redirect=permanent,last]
RewriteRule ^/availableNewspaperChart.txt /newspapers.txt [redirect=permanent,last]
RewriteRule ^/search_fulltext_advanced.html /search/pages/ [redirect=permanent,last]
RewriteRule ^/search_directory_advanced.html /search/titles/ [redirect=permanent,last]
RewriteRule ^/about.html /about/ [redirect=permanent,last]
RewriteRule ^/help.html /help/ [redirect=permanent,last]
RewriteRule ^/search_results_advanced.html  /search/pages/results/ [redirect=permanent,last]
RewriteRule ^/explainOCR.html  /about/ocr/ [redirect=permanent,last]
RewriteRule ^/lccn/(.+)/essay/?$ /lccn/$1/essays/ [redirect=permanent]
RewriteRule ^/titles/place/(.+)$ /titles/places/$1 [redirect=permanent]
RewriteRule ^/batches.xml /batches/feed/ [redirect=permanent,last]
RewriteRule ^/events.xml /events/feed/ [redirect=permanent,last]

RewriteRule ^/sitemap.xml$ /ndnp/staging/chronam/chronam/static/sitemaps/sitemap.xml
RewriteRule ^/(sitemap-\d+.xml)$ /ndnp/staging/chronam/chronam/static/sitemaps/$1

#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/ndnp/staging/chronam/chronam/static"

WSGISocketPrefix /ndnp/staging/
WSGIDaemonProcess chronam-wsgi-app processes=4 threads=16 python-eggs=/ndnp/staging/.python-eggs 
WSGIProcessGroup chronam-wsgi-app
WSGIScriptAlias / /ndnp/staging/chronam/conf/django-staging.wsgi 

AliasMatch ^/data/(.+) /batches/$1
AliasMatch ^/data/ /batches/
Alias /robots.txt /ndnp/staging/chronam/chronam/static/robots.txt
Alias /sitemaps/ /ndnp/staging/chronam/chronam/static/sitemaps/

#
# Each directory to which Apache has access can be configured with respect
# to which services and features are allowed and/or disabled in that
# directory (and its subdirectories). 
#
# First, we configure the "default" to be a very restrictive set of 
# features.  
#
<Directory />
    Options FollowSymLinks
    AllowOverride None
    Order deny,allow
    Allow from all
</Directory>

#
# Note that from this point forward you must specifically allow
# particular features to be enabled - so if something's not working as
# you might expect, make sure that you have specifically enabled it
# below.
#
<Directory /ndnp/staging/chronam/chronam/static>
    ExpiresActive On
    ExpiresDefault A86400

    Options Indexes FollowSymLinks
    AllowOverride None

    Order allow,deny
    Allow from all

</Directory>

<Directory /batches>
    Options Indexes FollowSymLinks
    Allow from all
</Directory>

#
# DirectoryIndex: sets the file that Apache will serve if a directory
# is requested.
#
<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>

#
# The following lines prevent .htaccess and .htpasswd files from being 
# viewed by Web clients. 
#
<FilesMatch "^\.ht">
    Order allow,deny
    Deny from all
    Satisfy All
</FilesMatch>

#
# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog "|/ndnp/staging/apache2/bin/rotatelogs /ndnp/staging/apache2/logs/error_log.%Y%m%d 86400"

#
# LogLevel: Control the number of messages logged to the error_log.
# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
#
LogLevel warn

<IfModule log_config_module>
    #
    # The following directives define some format nicknames for use with
    # a CustomLog directive (see below).
    #
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" \"%{Accept}i\" \"%{Cache-Control}i\" \"%{Pragma}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a <VirtualHost>
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-<VirtualHost> access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    CustomLog "|/ndnp/staging/apache2/bin/rotatelogs /ndnp/staging/apache2/logs/access_log.%Y%m%d 86400" combined

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    #CustomLog "logs/access_log" combined

    SetEnv CACHE_MISS 1
    LogFormat "%t \"%r\" %X %D %{CACHE_MISS}e %>s" performance
    CustomLog "|/ndnp/staging/apache2/bin/rotatelogs /ndnp/staging/apache2/logs/performance_log.%Y%m%d 86400" performance

</IfModule>

#
# DefaultType: the default MIME type the server will use for a document
# if it cannot otherwise determine one, such as from filename extensions.
# If your server contains mostly text or HTML documents, "text/plain" is
# a good value.  If most of your content is binary, such as applications
# or images, you may want to use "application/octet-stream" instead to
# keep browsers from trying to display binary files as though they are
# text.
#
DefaultType text/plain

<IfModule mime_module>
    #
    # TypesConfig points to the file containing the list of mappings from
    # filename extension to MIME-type.
    #
    TypesConfig conf/mime.types

    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz

</IfModule>
