
#Run on the default port
#Listen *:8080

<IfModule mod_cache.c>
  <IfModule mod_disk_cache.c>
    CacheIgnoreCacheControl On
    CacheRoot /indexes/cache
    CacheEnable disk /
    CacheEnable disk http://
    CacheDisable /data
    CacheDirLevels 5
    CacheDefaultExpire 3600
    CacheMaxFileSize 2000000
  </IfModule> 
</IfModule>


#
# ServerName gives the name and port that the server uses to identify itself.
# This can often be determined automatically, but we recommend you specify
# it explicitly to prevent problems during startup.
#
# If your host doesn't have a registered DNS name, enter its IP address here.
#

#ServerName chroniclingamerica.loc.gov

RewriteEngine  on

#RewriteCond %{HTTP_HOST}   !^chroniclingamerica\.loc\.gov [NC]
#RewriteCond %{HTTP_HOST}   !^$
#RewriteRule ^/(.*)         http://chroniclingamerica.loc.gov/$1 [redirect,last]

RewriteRule ^/index.html / [redirect=permanent,last]
RewriteRule ^/availableNewspapers.html /newspapers/ [redirect=permanent,last]
RewriteRule ^/availableNewspaperChart.txt /newspapers.txt [redirect=permanent,last]
RewriteRule ^/search_fulltext_advanced.html /search/pages/ [redirect=permanent,last]
RewriteRule ^/search_directory_advanced.html /search/titles/ [redirect=permanent,last]
RewriteRule ^/about.html /about/ [redirect=permanent,last]
RewriteRule ^/help.html /help/ [redirect=permanent,last]
RewriteRule ^/search_results_advanced.html  /search/pages/results/ [redirect=permanent,last]
RewriteRule ^/explainOCR.html  /about/ocr/ [redirect=permanent,last]
RewriteRule ^/lccn/(.+)/essay/?$ /lccn/$1/essays/ [redirect=permanent]
RewriteRule ^/titles/place/(.+)$ /titles/places/$1 [redirect=permanent]
RewriteRule ^/batches.xml /batches/feed/ [redirect=permanent,last]
RewriteRule ^/events.xml /events/feed/ [redirect=permanent,last]

RewriteRule ^/sitemap.xml$ /ndnp/staging/chronam/chronam/static/sitemaps/sitemap.xml
RewriteRule ^/(sitemap-\d+.xml)$ /ndnp/staging/chronam/chronam/static/sitemaps/$1

#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/ndnp/staging/chronam/chronam/static"

WSGISocketPrefix /ndnp/staging/
WSGIDaemonProcess chronam-wsgi-app processes=4 threads=16 python-eggs=/tmp/chronam-python-eggs  
WSGIProcessGroup chronam-wsgi-app
WSGIScriptAlias / /ndnp/staging/chronam/conf/django-staging.wsgi 

AliasMatch ^/data/(.+) /batches/$1
AliasMatch ^/data/ /batches/
Alias /robots.txt /ndnp/staging/chronam/chronam/static/robots.txt
Alias /sitemaps/ /ndnp/staging/chronam/chronam/static/sitemaps/

#
# Note that from this point forward you must specifically allow
# particular features to be enabled - so if something's not working as
# you might expect, make sure that you have specifically enabled it
# below.
#
<Directory /ndnp/staging/chronam/chronam/static>
    ExpiresActive On
    ExpiresDefault A86400

    Options Indexes FollowSymLinks
    AllowOverride None

    Order allow,deny
    Allow from all
</Directory>

# This directory doesn't exist, what was this for?
#<Directory /batches>
#    Options Indexes FollowSymLinks
#
#    Order allow,deny
#    Allow from all
#</Directory>

<IfModule log_config_module>
    #
    # The following directives define some format nicknames for use with
    # a CustomLog directive (see below).
    #
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" \"%{Accept}i\" \"%{Cache-Control}i\" \"%{Pragma}i\"" combined

    SetEnv CACHE_MISS 1
    #LogFormat "%t \"%r\" %X %D %{CACHE_MISS}e %>s" performance
    #CustomLog "logs/performance_log.%Y%m%d 86400" performance
</IfModule>
